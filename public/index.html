<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NØRR3 Marketing Engine</title>
  <link rel="stylesheet" href="styles.css"/>
  <link href="https://db.onlinewebfonts.com/c/d1f70229bc95cd614774210fd9934aa1?family=RocGrotesk-Regular" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
</head>
<body class="norr3-body">
  <div class="norr3-logo-wrapper">
    <a href="https://norr3.fi" aria-label="NØRR3 Homepage">
      <img src="https://norr3.fi/wp-content/uploads/2023/06/logo_valk-web.png" alt="NØRR3 Logo" class="norr3-login-logo"/>
    </a>
  </div>
  <div id="norr3-container" class="norr3-container" style="display: none;">
    <div id="norr3-alert" class="norr3-alert" style="display: none;" role="alert" aria-live="polite"></div>
    <div id="norr3-loading-screen" class="norr3-loading-screen" style="display: none;" aria-live="polite">
      <i class="fas fa-spinner fa-spin"></i> Loading...
    </div>
    <section id="norr3-service-selection" class="norr3-fade-in" style="display: none;" aria-live="polite">
      <h2 class="norr3-h2" data-translate="selectService">Select Your Service</h2>
      <div class="norr3-service-grid" role="radiogroup" aria-label="Select Service">
        <button onclick="norr3SelectService('kiinteistomaailma')" class="norr3-btn-service" type="button" aria-label="Kiinteistömaailma">Kiinteistömaailma</button>
        <button onclick="norr3SelectService('terveystalo')" class="norr3-btn-service" type="button" aria-label="Terveystalo">Terveystalo</button>
      </div>
    </section>
    <section id="norr3-campaign-setup" class="norr3-fade-in" style="display: none;" aria-live="polite">
      <div class="norr3-dashboard-header" role="banner">
        <h2 class="norr3-h2" data-translate="campaignManagement">Campaign Management</h2>
        <div class="norr3-dashboard-controls" role="toolbar" aria-label="Dashboard Controls">
          <div class="norr3-left-controls">
            <button onclick="norr3GoBack()" class="norr3-btn-back" type="button" style="display: none;" id="norr3-back-button">
              <i class="fas fa-arrow-left"></i> <span data-translate="back">Back</span>
            </button>
            <input type="text" id="norr3-search-campaigns" placeholder="Search campaigns..." aria-label="Search campaigns" />
            <select id="norr3-filter-status" aria-label="Filter campaigns by status">
              <option value="" data-translate="allStatuses">All Statuses</option>
              <option value="on" data-translate="active">Active</option>
              <option value="off" data-translate="paused">Paused</option>
            </select>
            <select id="norr3-filter-user" class="norr3-filter" data-translate="filterByUser">
              <option value="">All Users</option>
              <!-- Populate dynamically with user emails from users list -->
            </select>
            <select id="norr3-filter-agency" class="norr3-filter" data-translate="filterByAgency">
              <option value="">All Agencies</option>
              <option value="Kiinteistömaailma Helsinki">Kiinteistömaailma Helsinki</option>
              <option value="NØRR3">NØRR3</option>
            </select>
            <select id="norr3-filter-channel" class="norr3-filter" data-translate="filterByChannel">
              <option value="">All Channels</option>
              <option value="meta">Meta</option>
              <option value="display">Display</option>
              <option value="pdooh">PDOOH</option>
            </select>
            <select id="norr3-filter-city" class="norr3-filter" data-translate="filterByCity">
              <option value="">All Cities</option>
              <!-- Populate dynamically with unique cities from campaigns -->
            </select>
            <button class="norr3-btn-primary" onclick="norr3FetchCampaigns()" data-translate="fetchCampaigns">Fetch</button>
            <button class="norr3-btn-primary" onclick="norr3ExportCampaigns()" data-translate="exportCampaigns">Export</button>
            <button class="norr3-btn-primary" onclick="norr3CreateCampaign()" data-translate="createCampaign">Create</button>
            <button class="norr3-btn-primary" onclick="norr3Logout()" data-translate="logout">Logout</button>
            <div class="norr3-notification" role="button" tabindex="0" aria-label="Show notifications" onclick="norr3ShowNotifications()">
              <i class="fas fa-bell" id="norr3-notification-icon"></i>
            </div>
            <button onclick="norr3UserManagement()" class="norr3-btn-primary" type="button" style="display: none;" id="norr3-user-management-btn">
              <i class="fas fa-users"></i> <span data-translate="userManagement">User Management</span>
            </button>
          </div>
        </div>
      </div>
      <div class="norr3-metrics" role="region" aria-label="Campaign Metrics">
        <div class="norr3-metric-card" role="status"><span data-translate="activeCampaigns">Active Campaigns:</span> <span id="norr3-active-count">0</span></div>
        <div class="norr3-metric-card" role="status"><span data-translate="pausedCampaigns">Paused Campaigns:</span> <span id="norr3-paused-count">0</span></div>
        <div class="norr3-metric-card" role="status"><span data-translate="totalBudgetLabel">Total Budget:</span> <span id="norr3-total-budget">0€</span></div>
        <div class="norr3-metric-card" role="status"><span data-translate="lastUpdated">Last Updated:</span> <span id="norr3-last-updated">N/A</span></div>
      </div>
      <div class="norr3-campaign-table" role="table" aria-label="Campaign List">
        <div class="norr3-table-header" role="rowgroup">
          <span role="columnheader" data-translate="campaignId">Campaign ID</span>
          <span role="columnheader" data-translate="agent">Agent</span>
          <span role="columnheader" data-translate="includedApartments">Included Apartment Keys</span>
          <span role="columnheader" data-translate="start">Start</span>
          <span role="columnheader" data-translate="end">End</span>
          <span role="columnheader" data-translate="channels">Channels</span>
          <span role="columnheader" data-translate="budget">Budget</span>
          <span role="columnheader" data-translate="status">Status</span>
          <span role="columnheader" data-translate="actions">Actions</span>
        </div>
        <div id="norr3-campaign-list" class="norr3-table-body" role="rowgroup"></div>
      </div>
    </section>
    <section id="norr3-user-management" class="norr3-fade-in" style="display: none;" aria-live="polite">
      <h2 class="norr3-h2" data-translate="userManagement">User Management</h2>
      <div class="norr3-user-grid" role="form" aria-label="User Management Form">
        <input type="text" id="norr3-user-partner-name" placeholder="Partner Name" aria-label="Partner Name" required />
        <input type="text" id="norr3-user-agent-name" placeholder="Agent Name" aria-label="Agent Name" required />
        <input type="text" id="norr3-user-agent-key" placeholder="Agent Key" aria-label="Agent Key" required />
        <input type="url" id="norr3-user-agent-image" placeholder="Agent Image URL (optional)" aria-label="Agent Image URL" />
        <input type="email" id="norr3-user-email" placeholder="Email" aria-label="Email" required />
        <input type="password" id="norr3-user-password" placeholder="Password" aria-label="Password" required />
        <button onclick="norr3AddUser()" class="norr3-btn-primary" type="button" aria-label="Add User">Add User</button>
        <button onclick="norr3RemoveUser()" class="norr3-btn-primary" type="button" aria-label="Remove User">Remove User</button>
        <button onclick="norr3EditUser()" class="norr3-btn-primary" type="button" aria-label="Edit User">Edit User</button>
      </div>
      <div id="norr3-user-list" class="norr3-user-table" role="table" aria-label="User List"></div>
    </section>
    <div id="norr3-create-modal" class="norr3-modal" style="display: none;" role="dialog" aria-label="Create New Campaign">
      <div class="norr3-modal-content norr3-slide-in norr3-two-columns">
        <div class="norr3-modal-right">
          <button class="norr3-close-btn" onclick="norr3CloseCreateModal(event)" aria-label="Close modal">×</button>
          <h3 class="norr3-h3" data-translate="createCampaign">Create Campaign</h3>
          <div class="norr3-modal-section">
            <h4 class="norr3-h4" data-translate="dates">Dates</h4>
            <label>Start Date: <input type="date" id="norr3-create-start-date" class="norr3-input-modern" aria-label="Start date" required /></label>
            <label>End Date: <input type="date" id="norr3-create-end-date" class="norr3-input-modern" aria-label="End date" /></label>
            <p>
              <span data-translate="ongoing">Ongoing</span>:
              <label class="norr3-toggle-slider">
                <input type="checkbox" id="norr3-create-ongoing" onchange="norr3ToggleCreateEndDate()" aria-label="Ongoing campaign" />
                <span class="norr3-slider" role="switch" aria-checked="false"></span>
              </label>
            </p>
          </div>
          <div class="norr3-modal-actions">
            <button onclick="norr3SaveCampaign()" class="norr3-btn-primary" data-translate="saveCampaign" aria-label="Save Campaign">Save Campaign</button>
            <button onclick="norr3CloseCreateModal(event)" class="norr3-btn-primary" data-translate="cancel" aria-label="Cancel">Cancel</button>
          </div>
        </div>
        <div class="norr3-modal-left">
          <h4 class="norr3-h4" data-translate="apartments">Apartments</h4>
          <button onclick="norr3AddApartment()" class="norr3-btn-primary" type="button" aria-label="Add Apartment">Add Apartments</button>
          <div id="norr3-selected-apartments" class="norr3-apartment-list" role="list" aria-label="Selected Apartments"></div>
        </div>
      </div>
    </div>
    <div id="norr3-edit-modal" class="norr3-modal" style="display: none;" role="dialog" aria-label="Edit Campaign">
      <div class="norr3-modal-content norr3-slide-in norr3-two-columns">
        <div class="norr3-modal-left">
          <button class="norr3-close-btn" onclick="norr3CloseModal(event)" aria-label="Close modal">×</button>
          <h3 class="norr3-h3" data-translate="editCampaign">Edit Campaign</h3>
          <div class="norr3-modal-section">
            <h4 class="norr3-h4" data-translate="dates">Dates</h4>
            <label>Start Date: <input type="date" id="norr3-modal-start-date" class="norr3-input-modern" aria-label="Start date" required /></label>
            <label>End Date: <input type="date" id="norr3-modal-end-date" class="norr3-input-modern" aria-label="End date" /></label>
            <p>
              <span data-translate="ongoing">Ongoing</span>:
              <label class="norr3-toggle-slider">
                <input type="checkbox" id="norr3-modal-ongoing" onchange="norr3ToggleEndDate()" aria-label="Ongoing campaign" />
                <span class="norr3-slider" role="switch" aria-checked="false"></span>
              </label>
            </p>
          </div>
          <div class="norr3-modal-actions">
            <button onclick="norr3SaveCampaign()" class="norr3-btn-primary" data-translate="saveCampaign" aria-label="Save Campaign">Save Campaign</button>
            <button onclick="norr3CloseModal(event)" class="norr3-btn-primary" data-translate="cancel" aria-label="Cancel">Cancel</button>
            <button onclick="norr3ConfirmEdits()" class="norr3-btn-primary" data-translate="confirmEdits" aria-label="Confirm Edits">Confirm Edits</button>
          </div>
        </div>
        <div class="norr3-modal-left">
          <h4 class="norr3-h4" data-translate="apartments">Apartments</h4>
          <button onclick="norr3AddApartment()" class="norr3-btn-primary" type="button" aria-label="Add Apartment">Add Apartments</button>
          <div id="norr3-selected-apartments" class="norr3-apartment-list" role="list" aria-label="Selected Apartments"></div>
        </div>
      </div>
    </div>
    <div id="norr3-apartment-modal" class="norr3-modal" style="display: none;" role="dialog" aria-label="Select Apartments">
      <div class="norr3-modal-content norr3-slide-in norr3-two-columns">
        <div class="norr3-modal-left">
          <button class="norr3-close-btn" onclick="norr3CloseApartmentModal(event)" aria-label="Close modal">×</button>
          <h3 class="norr3-h3" data-translate="selectApartments" role="heading" aria-level="3">Select Apartments</h3>
          <div id="norr3-apartment-list" class="norr3-apartment-table" role="table" aria-label="Apartment List"></div>
        </div>
        <div class="norr3-modal-right">
          <h4 class="norr3-h4">Apartment Settings</h4>
          <label>Radius:
            <input type="number" id="norr3-apartment-radius" class="norr3-input-modern norr3-budget-input" placeholder="Radius (meters)" aria-label="Radius in meters" required/>
          </label>
          <div class="norr3-modal-section">
            <p>Meta:
              <label class="norr3-toggle-slider">
                <input type="checkbox" name="norr3-apartment-channel" value="meta" onchange="norr3UpdateApartmentChannels()" aria-label="Meta channel"/>
                <span class="norr3-slider"></span>
              </label>
              <input type="number" id="norr3-apartment-budget-meta" class="norr3-input-modern norr3-budget-input" placeholder="Budget (€)" aria-label="Meta budget" min="0" required disabled style="opacity: 0.5;"/>
            </p>
            <p>Display:
              <label class="norr3-toggle-slider">
                <input type="checkbox" name="norr3-apartment-channel" value="display" onchange="norr3UpdateApartmentChannels()" aria-label="Display channel"/>
                <span class="norr3-slider"></span>
              </label>
              <input type="number" id="norr3-apartment-budget-display" class="norr3-input-modern norr3-budget-input" placeholder="Budget (€)" aria-label="Display budget" min="0" required disabled style="opacity: 0.5;"/>
            </p>
            <p>PDOOH:
              <label class="norr3-toggle-slider">
                <input type="checkbox" name="norr3-apartment-channel" value="pdooh" onchange="norr3UpdateApartmentChannels()" aria-label="PDOOH channel"/>
                <span class="norr3-slider"></span>
              </label>
              <input type="number" id="norr3-apartment-budget-pdooh" class="norr3-input-modern norr3-budget-input" placeholder="Budget (€)" aria-label="PDOOH budget" min="0" required disabled style="opacity: 0.5;"/>
            </p>
          </div>
          <div class="norr3-modal-actions">
            <button onclick="norr3AddSelectedApartment()" class="norr3-btn-primary" data-translate="add" aria-label="Add Selected Apartment">Add</button>
            <button onclick="norr3CloseApartmentModal(event)" class="norr3-btn-primary" data-translate="cancel" aria-label="Cancel">Cancel</button>
          </div>
        </div>
      </div>
    </div>
    <div id="norr3-apartment-info-modal" class="norr3-modal" style="display: none;" role="dialog" aria-label="Apartment Details">
      <div class="norr3-modal-content norr3-slide-in">
        <button class="norr3-close-btn" onclick="norr3CloseApartmentInfoModal(event)" aria-label="Close modal">×</button>
        <h3 class="norr3-h3" data-translate="apartmentDetails" role="heading" aria-level="3">Apartment Details</h3>
        <div id="norr3-apartment-info" class="norr3-apartment-info" role="region" aria-label="Apartment Information"></div>
      </div>
    </div>
    <div id="norr3-campaign-info-modal" class="norr3-modal" style="display: none;" role="dialog" aria-label="Campaign Details">
      <div class="norr3-modal-content norr3-slide-in">
        <button class="norr3-close-btn" onclick="norr3CloseCampaignInfoModal(event)" aria-label="Close modal">×</button>
        <h3 class="norr3-h3" data-translate="campaignDetails" role="heading" aria-level="3">Campaign Details</h3>
        <div id="norr3-campaign-info" class="norr3-campaign-info" role="region" aria-label="Campaign Information"></div>
      </div>
    </div>
    <div id="norr3-notification-modal" class="norr3-modal" style="display: none;" role="dialog" aria-label="Notifications">
      <div class="norr3-modal-content norr3-slide-in">
        <button class="norr3-close-btn" onclick="norr3CloseNotificationModal(event)" aria-label="Close notifications">×</button>
        <h3 class="norr3-h3" data-translate="notifications" role="heading" aria-level="3">Notifications</h3>
        <div id="norr3-notification-list" role="log" aria-live="polite"></div>
      </div>
    </div>
  </div>
  <section id="norr3-login-section" class="norr3-fade-in" aria-live="polite">
    <div class="norr3-login-box" role="form">
      <input type="email" id="norr3-email" placeholder="e.g. seppo.kairikko@kiinteistomaailma.fi" required/>
      <input type="password" id="norr3-password" placeholder="Password" required/>
      <button onclick="norr3ManualLogin()" class="norr3-btn-google" data-translate="login">Login</button>
      <button onclick="norr3GoogleLogin()" class="norr3-btn-google" data-translate="loginWithGoogle">Login with Google</button>
    </div>
  </section>
  <div class="norr3-language-switcher">
    <a href="#" data-lang="en">EN</a> <span>|</span>
    <a href="#" data-lang="fi">FI</a> <span>|</span>
    <a href="#" data-lang="sv">SV</a>
  </div>
  <script src="script.js"></script>
</body>
</html>
